<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register - Veralis</title>
  <link rel="icon" type="image/png" href="../images/ui-pics/veralisfavicon.png">
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <div class="overlay"></div>

<header>
  <div class="header-container">
    <a href="index.html" class="logo-container">
      <img src="../images/ui-pics/veralis_logo_transparent.png" alt="Veralis Logo" />
    </a>
     <div class="middle-container">
     <div class="call-to-arm hidden-btn">Already have an account?</div>
    <button class="login-btn" onclick="location.href='login.html'">Log In</button>
   </div>

   <div class="language-switcher-container">
  <button id="langBtn">
    <img src="../images/flags/gb.svg" alt="EN" class="flag-icon" />
    <span class="lang-text">EN</span> ‚ñº
  </button>
  <ul id="langList" class="hidden">
    <li data-lang="cs"><img src="../images/flags/cz.svg" alt="CZ" class="flag-icon" /> CZ</li>
    <li data-lang="en"><img src="../images/flags/gb.svg" alt="EN" class="flag-icon" /> EN</li>
  </ul>
</div>

    </div>
  </header>

<!-- üîΩ STATUS BAR WRAPPER START -->
<div id="status-bar-wrapper" class="hidden">
  <div id="status-bar">
    <span id="status-message">‚úÖ Status message</span>
    <button id="status-close" onclick="hideStatus()">√ó</button>
  </div>
</div>
<!-- üîº STATUS BAR WRAPPER END -->

<main>
  <div class="register-wrapper">
    <p class="register-info">
      Please enter your username and email. A confirmation email with a temporary password will be sent to you.
    </p>
    <div class="register-box">
      <h2 class="register-title">Register</h2>
      <form id="registrationForm">
        <label for="username">Username</label>
        <input type="text" id="username" name="username" required>

        <label for="email">Email</label>
        <input type="email" id="email" name="email" required>

        <label for="emailConfirm">Confirm Email</label>
        <input type="email" id="emailConfirm" name="emailConfirm" required autocomplete="new-password">

        <div class="checkbox-row">
          <div class="checkbox-label">
            I agree to the <a href="../tos.html" target="_blank" class="terms-link">terms of use</a>
          </div>
          <div class="checkbox-box">
            <input type="checkbox" name="termsAccepted" required>
          </div>
        </div>

        <div class="checkbox-row">
          <div class="checkbox-label">
            I agree to the <a href="../rules.html" target="_blank" class="terms-link">community rules</a>
          </div>
          <div class="checkbox-box">
            <input type="checkbox" name="rulesAccepted" required>
          </div>
        </div>

        <input type="hidden" name="lang" value="en">

        <div class="captcha-container">
          <div class="g-recaptcha" data-sitekey="6LerhZArAAAAAPlTYpcghFJ7KqB3MLbYpckCr7fg"></div>
        </div>

        <button type="submit">Register</button>
      </form>
    </div>
  </div>
</main>

<footer>
  <div class="footer-content">
    <a href="index.html">About</a> |
    <a href="register.html">Register</a> |
    <a href="login.html">Login</a> |
    <a href="support.html">Support</a>
    <p class="small">¬© 2025 Project Veralis</p>
  </div>
</footer>

<script>
const form = document.getElementById('registrationForm');
form.addEventListener("submit", async (event) => {
  event.preventDefault();
  const captchaToken = grecaptcha.getResponse();
  if (!captchaToken) {
    showStatus("Please confirm you're not a robot.", false);
    return;
  }

  const formData = {
    username: document.getElementById('username').value.trim(),
    email: document.getElementById('email').value.trim(),
    emailConfirm: document.getElementById('emailConfirm').value.trim(),
    termsAccepted: form.querySelector('input[name="termsAccepted"]').checked,
    rulesAccepted: form.querySelector('input[name="rulesAccepted"]').checked,
    lang: form.querySelector('input[name="lang"]').value || 'en',
    captcha: captchaToken
  };

  if (!formData.username) return showStatus('Please enter a username.', false);
  if (!formData.email) return showStatus('Please enter an email.', false);
  if (formData.email !== formData.emailConfirm) return showStatus('Emails do not match.', false);
  if (!formData.termsAccepted || !formData.rulesAccepted) return showStatus('You must agree to the terms and rules.', false);

  try {
    const response = await fetch('https://veralis-backend-production.up.railway.app/api/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    });

    const result = await response.json();
    if (response.ok) {
      showStatus(result.message || 'Registration successful. Check your email.', true);
      form.reset();
      grecaptcha.reset();
    } else {
      showStatus(result.error || 'An error occurred during registration.', false);
      grecaptcha.reset();
    }
  } catch (error) {
    showStatus('Failed to send registration. Please try again later.', false);
    console.error('Error:', error);
  }
});
</script>

<script>
const langBtn = document.getElementById('langBtn');
const langList = document.getElementById('langList');

if (langBtn && langList) {
  (() => {
    const path = window.location.pathname;
    const isEN = path.includes('/en/');
    langBtn.querySelector('img').src = isEN ? '../images/flags/gb.svg' : '../images/flags/cz.svg';
    langBtn.querySelector('.lang-text').textContent = isEN ? 'EN' : 'CZ';
  })();

  langBtn.addEventListener('click', () => {
    langList.classList.toggle('visible');
  });

  langList.querySelectorAll('li').forEach(li => {
    li.addEventListener('click', () => {
      const lang = li.getAttribute('data-lang');
      const current = window.location.pathname.split('/').pop();

      if (lang === 'en' && !window.location.pathname.includes('/en/')) {
        window.location.href = 'en/' + current;
      } else if (lang === 'cs' && window.location.pathname.includes('/en/')) {
        window.location.href = '../' + current;
      }
    });
  });

  document.addEventListener('click', (e) => {
    if (!langBtn.contains(e.target) && !langList.contains(e.target)) {
      langList.classList.remove('visible');
    }
  });
}
</script>

<script>
function showStatus(message, isSuccess = false, isInfo = false) {
  const wrapper = document.getElementById('status-bar-wrapper');
  const bar = document.getElementById('status-bar');
  const messageBox = document.getElementById('status-message');

  wrapper.classList.remove('hidden');
  bar.classList.remove('status-success', 'status-error', 'status-info');

  if (isInfo) {
    bar.classList.add('status-info');
    messageBox.textContent = `‚ÑπÔ∏è ${message}`;
  } else if (isSuccess) {
    bar.classList.add('status-success');
    messageBox.textContent = `‚úÖ ${message}`;
  } else {
    bar.classList.add('status-error');
    messageBox.textContent = `‚ùå ${message}`;
  }

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideStatus() {
  const wrapper = document.getElementById('status-bar-wrapper');
  const bar = document.getElementById('status-bar');

  wrapper.classList.add('hidden');
  bar.classList.remove('status-success', 'status-error', 'status-info');
}
</script>

<script src="https://www.google.com/recaptcha/api.js?hl=en" async defer></script>
</body>
</html>
