<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registrace - Veralis</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="overlay"></div>

<header>
  <div class="header-container">
    <a href="index.html" class="logo-container">
      <img src="images/ui-pics/veralis_logo_transparent.png" alt="Veralis Logo" />
    </a>
     <div class="middle-container">
     <div class="call-to-arm hidden-btn">U≈æ m√°te √∫ƒçet?</div>
    <button class="login-btn" onclick="location.href='login.html'">P≈ôihl√°sit se</button>
   </div>

   <div class="language-switcher-container">
  <button id="langBtn">
    <img src="images/flags/cz.svg" alt="CZ" class="flag-icon" />
    <span class="lang-text">CZ</span> ‚ñº
  </button>
  <ul id="langList" class="hidden">
    <li data-lang="cs"><img src="images/flags/cz.svg" alt="CZ" class="flag-icon" /> CZ</li>
    <li data-lang="en"><img src="images/flags/gb.svg" alt="EN" class="flag-icon" /> EN</li>
  </ul>
</div>

    </div>
  </header>

  <!-- üîΩ STATUS BAR WRAPPER START -->
<div id="status-bar-wrapper" class="hidden">
  <div id="status-bar">
    <span id="status-message">‚úÖ Status hl√°≈°ka</span>
    <button id="status-close" onclick="hideStatus()">√ó</button>
  </div>
</div>
<!-- üîº STATUS BAR WRAPPER END -->
  
<main>
  <div class="register-wrapper">
    <p class="register-info">
      Vypl≈àte pros√≠m sv√© u≈æivatelsk√© jm√©no a e-mail. Na e-mail v√°m p≈ôijde potvrzen√≠ a doƒçasn√© heslo, kter√© si pak m≈Ø≈æete zmƒõnit.
    </p>
    <div class="register-box">
      <h2 class="register-title">Registrace</h2>
      <form id="registrationForm">
        <label for="username">U≈æivatelsk√© jm√©no</label>
        <input type="text" id="username" name="username" required>

        <label for="email">Email</label>
        <input type="email" id="email" name="email" required>

        <label for="emailConfirm">Potvrƒète email</label>
        <input type="email" id="emailConfirm" name="emailConfirm" required autocomplete="new-password">

        <div class="checkbox-row">
          <div class="checkbox-label">
            Souhlas√≠m s <a href="tos.html" target="_blank" class="terms-link">podm√≠nkami pou≈æit√≠</a>
          </div>
          <div class="checkbox-box">
            <input type="checkbox" name="termsAccepted" required>
          </div>
        </div>

        <div class="checkbox-row">
          <div class="checkbox-label">
            Souhlas√≠m s <a href="rules.html" target="_blank" class="terms-link">komunitn√≠mi pravidly</a>
          </div>
          <div class="checkbox-box">
            <input type="checkbox" name="rulesAccepted" required>
          </div>
        </div>

       <input type="hidden" name="lang" value="cs">

        <div class="captcha-container">
  <div class="g-recaptcha" data-sitekey="6LerhZArAAAAAPlTYpcghFJ7KqB3MLbYpckCr7fg"></div>
</div>
        
        <button type="submit">Registrovat</button>
      </form>
    </div>
  </div>
</main>

<footer>
  <div class="footer-content">
    <a href="index.html">O h≈ôe</a> |
    <a href="register.html">Registrace</a> |
    <a href="login.html">P≈ôihl√°≈°en√≠</a> |
    <a href="support.html">Podpora</a>
    <p class="small">¬© 2025 Projekt Veralis</p>
  </div>
</footer>

<script>
console.log("Lang switch INIT");
console.log("langBtn:", document.getElementById('langBtn'));
console.log("langList:", document.getElementById('langList'));
const form = document.getElementById('registrationForm');
</script>

  <script>
form.addEventListener("submit", async (event) => {
  event.preventDefault();
  const captchaToken = grecaptcha.getResponse();
  if (!captchaToken) {
    showStatus("Pros√≠m ovƒõ≈ôte, ≈æe nejste robot.", false);
    return;
  }

  const formData = {
    username: document.getElementById('username').value.trim(),
    email: document.getElementById('email').value.trim(),
    emailConfirm: document.getElementById('emailConfirm').value.trim(),
    termsAccepted: form.querySelector('input[name="termsAccepted"]').checked,
    rulesAccepted: form.querySelector('input[name="rulesAccepted"]').checked,
    lang: form.querySelector('input[name="lang"]').value || 'cs',
    captcha: captchaToken
  };

  if (!formData.username) return showStatus('Zadejte u≈æivatelsk√© jm√©no.', false);
  if (!formData.email) return showStatus('Zadejte email.', false);
  if (formData.email !== formData.emailConfirm) return showStatus('E-maily se neshoduj√≠.', false);
  if (!formData.termsAccepted || !formData.rulesAccepted) return showStatus('Mus√≠te souhlasit s podm√≠nkami a pravidly.', false);

  try {
    const response = await fetch('https://veralis-backend-production.up.railway.app/api/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(formData),
    });

    const result = await response.json();
    if (response.ok) {
      showStatus(result.message || 'Registrace probƒõhla √∫spƒõ≈°nƒõ. Zkontrolujte sv≈Øj email.', true);
      form.reset();
      grecaptcha.reset();  // Reset captcha token po √∫spƒõchu
    } else {
      showStatus(result.error || 'Do≈°lo k chybƒõ p≈ôi registraci.', false);
      grecaptcha.reset();  // Reset captcha token po chybƒõ
    }
  } catch (error) {
    showStatus('Nepoda≈ôilo se odeslat registraci. Zkuste to pros√≠m pozdƒõji.', false);
    console.error('Chyba:', error);
  }
});
</script>

<script>
  const langBtn = document.getElementById('langBtn');
  const langList = document.getElementById('langList');

  console.log("TEST: langBtn = ", langBtn);
  console.log("TEST: langList = ", langList);

  if (langBtn && langList) {
    (() => {
      const path = window.location.pathname;
      const isEN = path.includes('/en/');
      langBtn.querySelector('img').src = isEN ? '../images/flags/gb.svg' : 'images/flags/cz.svg';
      langBtn.querySelector('.lang-text').textContent = isEN ? 'EN' : 'CZ';
    })();

    langBtn.addEventListener('click', () => {
      console.log("Klik na jazykov√Ω p≈ôep√≠naƒç");
      langList.classList.toggle('visible');
    });

    langList.querySelectorAll('li').forEach(li => {
      li.addEventListener('click', () => {
        const lang = li.getAttribute('data-lang');
        const current = window.location.pathname.split('/').pop();

        if (lang === 'en' && !window.location.pathname.includes('/en/')) {
          window.location.href = 'en/' + current;
        } else if (lang === 'cs' && window.location.pathname.includes('/en/')) {
          window.location.href = '../' + current;
        }
      });
    });

    document.addEventListener('click', (e) => {
      if (!langBtn.contains(e.target) && !langList.contains(e.target)) {
        langList.classList.remove('visible');
      }
    });
  }
</script>
  
<script>
function showStatus(message, isSuccess = false, isInfo = false) {
  const wrapper = document.getElementById('status-bar-wrapper');
  const bar = document.getElementById('status-bar');
  const messageBox = document.getElementById('status-message');

  // Reset t≈ô√≠d
  wrapper.classList.remove('hidden');
  bar.classList.remove('status-success', 'status-error', 'status-info');

  // Nastaven√≠ typu hl√°≈°ky
  if (isInfo) {
    bar.classList.add('status-info');
    messageBox.textContent = `‚ÑπÔ∏è ${message}`;
  } else if (isSuccess) {
    bar.classList.add('status-success');
    messageBox.textContent = `‚úÖ ${message}`;
  } else {
    bar.classList.add('status-error');
    messageBox.textContent = `‚ùå ${message}`;
  }

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideStatus() {
  const wrapper = document.getElementById('status-bar-wrapper');
  const bar = document.getElementById('status-bar');

  // Pro jistotu oba schovat
  wrapper.classList.add('hidden');
  bar.classList.remove('status-success', 'status-error', 'status-info');
}
</script>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
</body>
</html>
